è®¾ç½®å¼€æœºè‡ªå¯åŠ¨
sudo chmod +x ./boot_server_installer.sh
./boot_server_installer.sh

åœæ­¢è„šæœ¬ï¼š
./stop_comfyui.sh
å¯åŠ¨è„šæœ¬
./start_comfyui.sh

1. æ¿€æ´»ç¯å¢ƒ

conda activate ./my_env
2. è¿è¡Œä¸»ç¨‹åºï¼Œç”¨8188ç«¯å£
python main.py --listen --enable-cors-header --output-directory /mnt/SD01/projects/ComfyUI_base/output --input-directory /mnt/SD01/projects/ComfyUI_base/input --user-directory /mnt/SD01/projects/ComfyUI_base/user --port 8188 --cuda-device 0 

æŒ‡å®šæ˜¾å¡å’Œç«¯å£çš„å‚æ•°
--port 8188 --cuda-device 0 

å¯åŠ¨æ’ä»¶é»‘åå•çš„å‚æ•°
--blacklist-custom-nodes ComfyUI-Sentinel

3. æ‰“å¼€æµè§ˆå™¨è¾“å…¥ç½‘å€
æœ¬æœº
http://127.0.0.1:8188
å±€åŸŸç½‘
http://192.168.110.2:8188


4. å¦‚æœè¦åå°è¿è¡Œ
# åˆ›å»ºæ–°çš„screenä¼šè¯
screen -S comfyui

# åœ¨screenä¼šè¯ä¸­è¿è¡Œç¨‹åº
æ¿€æ´»ç¯å¢ƒ
conda activate ./my_env
python main.py --listen --enable-cors-header --output-directory /mnt/sdb2/ubuntu/ComfyUI_base/output --input-directory /mnt/sdb2/ubuntu/ComfyUI_base/input --user-directory /mnt/sdb2/ubuntu/ComfyUI_base/user --port 8189 --cuda-device 1 --blacklist-custom-nodes ComfyUI-Sentinel


# æŒ‰Ctrl+Aï¼Œç„¶åæŒ‰Dé”®å¯ä»¥ detach ä¼šè¯ï¼Œç¨‹åºä¼šåœ¨åå°ç»§ç»­è¿è¡Œ
# é‡æ–°è¿æ¥ä¼šè¯
screen -r comfyui

# æŸ¥æ‰¾å¹¶ç»“æŸå ç”¨ç«¯å£çš„è¿›ç¨‹
# æŸ¥æ‰¾å ç”¨8188ç«¯å£çš„è¿›ç¨‹
lsof -i :8188

# å¦‚æœä¸Šé¢çš„å‘½ä»¤æ²¡æœ‰è¿”å›ç»“æœï¼Œå°è¯•è¿™ä¸ª
netstat -tuln | grep 8188

# æ‰¾åˆ°è¿›ç¨‹IDï¼ˆPIDï¼‰åï¼Œä½¿ç”¨killå‘½ä»¤ç»“æŸå®ƒ
kill -9 [PID]

5. å±€åŸŸç½‘å¼€æ”¾æœ¬æœºç«¯å£
```bash
sudo ufw status
sudo ufw enable  # å¦‚æœæœªå¯ç”¨ï¼Œå…ˆå¯ç”¨

sudo ufw allow 8188/tcp
sudo ufw reload  # é‡æ–°åŠ è½½é˜²ç«å¢™è§„åˆ™
```

æ³¨æ„
1. å¦‚æœæ²¡æœ‰é¡¹ç›®ä¸­æ²¡æœ‰my_envæ–‡ä»¶å¤¹ï¼Œå…ˆåˆ›å»ºç‹¬ç«‹ç¯å¢ƒ
```cmd
conda create -p ./my_env python=3.12.4
```
2. åœ¨custom_nodesç›®å½•ä¸­
git clone https://github.com/MrForExample/ComfyUI-3D-Pack.git

3. cd ComfyUI-3D-Pack
pip install -r requirements.txt
python ./install.py

4. å›åˆ°é¡¹ç›®æ ¹ç›®å½•
pip install -r requirements.txt

5. å¦‚æœtorchå‡ºé”™ï¼Œä¿®æ­£æŸ¥æ‰¾pytorch3då’Œtorchèƒ½å¯¹åº”çš„ç‰ˆæœ¬:
https://anaconda.org/pytorch3d/pytorch3d/files?page=2
https://data.pyg.org/whl/
å…¼å®¹comfyui-3d-packçš„torchç‰ˆæœ¬ï¼štorch241+cuda121
1. å®‰è£…å››ä»¶å¥—ï¼špip install torch==2.7.0 torchvision torchaudio xformers --extra-index-url https://download.pytorch.org/whl/cu128
2. å®‰è£…é¡¹ç›®æ ¹ç›®å½•ä¸­çš„pytorch3dï¼š conda install ./pytorch3d-0.7.8-py312_cu121_pyt241.tar.bz2
3. å®‰è£…é¡¹ç›®æ ¹ç›®å½•ä¸­çš„torch_scatter: pip install ./torch_scatter

6. æ¨¡å‹ä¸‹è½½æºæ›¿æ¢
# ======åœ¨main.pyä¸­é¡¶éƒ¨æ·»åŠ HuggingFaceé•œåƒä»£ç ======
import os
import requests
from urllib.parse import urlparse

os.environ['HF_ENDPOINT'] = 'https://hf-mirror.com'
# os.environ['GIT_HUB_ENDPOINT'] = 'https://ghfast.top/https://github.com/'

original_request = requests.Session.request

def patched_request(self, method, url, **kwargs):
    parsed = urlparse(url)
    # Add redirect for raw.githubusercontent.com
    if parsed.netloc == "https://github.com":
        url = url.replace("https://github.com", "https://ghfast.top/https://github.com")
    return original_request(self, method, url, **kwargs)

requests.Session.request = patched_request
# ==========æ·»åŠ ç»“æŸ===========

7. comfyui-copilot
zhuangjia777@foxmail.com
a13df43df87542dbad6f61d460452294

8. ä¿®å¤æŠ¥é”™comfyUI-3D-Pack
ImportError: cannot import name '_load_state_dict_into_model' from 'diffusers.models.modeling_utils' (/home/ck/myProjects/ComfyUI-3D/my_env/lib/python3.12/site-packages/diffusers/models/modeling_utils.py)
ä¿®å¤æ–¹æ¡ˆï¼š
# from diffusers.models.modeling_utils import ModelMixin, load_state_dict, _load_state_dict_into_model
from diffusers.models.modeling_utils import ModelMixin, load_state_dict

# error_msgs = _load_state_dict_into_model(model_to_load, state_dict)
error_msgs = model_to_load.load_state_dict(state_dict, strict=False)


10. å¦‚æœå‡ºç°æŠ¥é”™ï¼š
# ğŸ˜ºdzNodes: LayerStyle -> Cannot import name 'guidedFilter' from 'cv2.ximgproc'
A few nodes cannot works properly, while most nodes are not affected. Please REINSTALL package 'opencv-contrib-python'.
è§£å†³æ–¹æ¡ˆï¼š
```
pip uninstall -y opencv-python opencv-python-headless opencv-contrib-python-headless opencv-contrib-python
pip install opencv-python opencv-python-headless opencv-contrib-python-headless
pip install opencv-contrib-python
```

9. å¦‚æœå‡ºç°æŠ¥é”™ï¼š
Optional node movie_editor import failed with error: No module named 'moviepy.editor'.If you don't need to use this optional node, this reminder can be ignored.â€‹
è§£å†³æ–¹æ¡ˆï¼šä¿®æ”¹ComfyUI_llm_party/custom_tool/moive_editorçš„å¯¼å…¥
```
# from moviepy.editor import *
from moviepy import VideoFileClip, AudioFileClip, ImageClip, concatenate_videoclips
```

10. å¯¹äºæ’ä»¶æ— æ³•åŒæ­¥ï¼Œgithubæ— æ³•é€šè¿‡æ ‡å‡†çš„å­æ¨¡å—å‘½ä»¤åˆå§‹åŒ–å®ƒï¼Œæˆ‘å»ºè®®å°†å…¶è½¬æ¢ä¸ºæ™®é€šç›®å½•ï¼š
# ç¬¬1æ­¥ï¼šç§»é™¤æ— æ•ˆçš„å­æ¨¡å—å¼•ç”¨ï¼ˆè¿™ä¸ä¼šåˆ é™¤å®é™…æ–‡ä»¶ï¼‰
git rm --cached custom_nodes/ComfyUI-Sentinel

# ç¬¬2æ­¥ï¼šç¡®ä¿ .gitignore é…ç½®æ­£ç¡®ï¼ˆä½ å·²ç»ä¿®æ”¹è¿‡äº†ï¼‰
/custom_nodes/*
!custom_nodes/example_node.py.example
!custom_nodes/ComfyUI-Sentinel/

# ç¬¬3æ­¥ï¼šæ£€æŸ¥ç›®å½•çŠ¶æ€
ls -la custom_nodes/ComfyUI-Sentinel

# ç¬¬4æ­¥ï¼šå¦‚æœç›®å½•å†…æœ‰è‡ªå·±çš„ .git ç›®å½•ï¼Œä¹Ÿéœ€è¦åˆ é™¤
rm -rf custom_nodes/ComfyUI-Sentinel/.git 2>/dev/null

# ç¬¬5æ­¥ï¼šå°†ç›®å½•ä½œä¸ºæ™®é€šæ–‡ä»¶æ·»åŠ åˆ°ä»“åº“
git add custom_nodes/ComfyUI-Sentinel/
git commit -m "Convert ComfyUI-Sentinel from invalid submodule to regular directory"

11. å¦‚æœsslæŠ¥é”™
# åœ¨æ–‡ä»¶å¼€å¤´è®¾ç½®SSLè¯ä¹¦æ–‡ä»¶è·¯å¾„
os.environ['SSL_CERT_FILE'] = '/home/ck/myProjects/ComfyUI/my_env/lib/python3.12/site-packages/certifi/cacert.pem'

12. å¤šå®ä¾‹comfyuiå¯åŠ¨

ä¿å­˜è„šæœ¬å¹¶è®¾ç½®æ‰§è¡Œæƒé™ï¼š
bash
chmod +x /mnt/sdb2/ubuntu/ComfyUI/run_multiple_comfyui.sh

è¿è¡Œè„šæœ¬ï¼ˆé»˜è®¤å¯åŠ¨2ä¸ªå®ä¾‹ï¼‰ï¼š
bash
./run_multiple_comfyui.sh

ä¹Ÿå¯ä»¥æŒ‡å®šè¦å¯åŠ¨çš„å®ä¾‹æ•°é‡ï¼š
bash
./run_multiple_comfyui.sh 8  # å¯åŠ¨8ä¸ªå®ä¾‹

è¦æŸ¥çœ‹æ—¥å¿—ï¼Œè¯·ä½¿ç”¨: 
bash
tail -f ./logs/comfyui_instance_*.log

è¦åœæ­¢æ‰€æœ‰å®ä¾‹ï¼Œè¯·ä½¿ç”¨: 
bash
pkill -f "python main.py"

å¦‚æœæ‚¨è®¡åˆ’è¿è¡Œå¤šä¸ªå®ä¾‹ï¼ˆå¦‚ç«¯å£8188-8195ï¼‰ï¼Œå¯ä»¥ä¸€æ¬¡æ€§å¼€æ”¾æ•´ä¸ªèŒƒå›´ï¼š
bash
sudo ufw allow 8188:8196/tcp

4. æŸ¥çœ‹å·²å¼€æ”¾çš„ç«¯å£
bash
sudo ufw status verbose

5. é‡å¯é˜²ç«å¢™ï¼ˆå¦‚æœéœ€è¦ï¼‰
bash
sudo ufw reload

13. æ·»åŠ å¯åŠ¨å‚æ•°-é»‘åå•æ’ä»¶åŠŸèƒ½
--blacklist-custom-nodes æ’ä»¶åç§°

ä¿®æ”¹comfy/cli_args.py
åœ¨
parser.add_argument("--whitelist-custom-nodes", type=str, nargs='+', default=[], help="Specify custom node folders to load even when --disable-all-custom-nodes is enabled.")
åæ·»åŠ 
parser.add_argument("--blacklist-custom-nodes", type=str, nargs='+', default=[], help="Specify custom node folders to skip loading.")

ä¿®æ”¹nodes.py
åœ¨      
if module_path.endswith(".disabled"): 
    continue
åæ·»åŠ 
# Check if node is in blacklist
if possible_module in args.blacklist_custom_nodes:
    logging.info(f"Skipping {possible_module} due to blacklist_custom_nodes")
    continue

14. å¦‚æœå‡ºç°æ‰¾ä¸åˆ°è¯ä¹¦é—®é¢˜ssl
bash
pip install certifi
python -c "import certifi; print(certifi.where())"
å¾—åˆ°è¯ä¹¦ä½ç½®
ä¿®æ”¹main.pyä¸­
os.environ['SSL_CERT_FILE'] = '/mnt/sdb2/ubuntu/ComfyUI/my_env/lib/python3.12/site-packages/certifi/cacert.pem'
